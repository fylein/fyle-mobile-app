<ion-header class="ion-no-border">
  <div class="my-profile--header">
    <ion-toolbar class="my-profile--header-toolbar">
      <ion-buttons slot="start">
        <ion-menu-button class="my-profile--menubutton" auto-hide="false"></ion-menu-button>
      </ion-buttons>
      <ion-title slot="primary" mode="ios" class="my-profile--title text-capitalize">Profile</ion-title>
    </ion-toolbar>
  </div>
</ion-header>

<ion-content>
  <div class="my-profile--blocks">
    <span class="my-profile--blocks-header">
      About You
    </span>
    <div *ngIf="eou$|async as eou">
      <div class="my-profile--card">
        <div class="my-profile--name my-profile--card-item">
          <div class="my-profile--name-label">
            Name
          </div>
          <div class="my-profile--name-value">
            {{eou.us.full_name}}
          </div>
        </div>

        <div class="my-profile--email my-profile--card-item">
          <div class="my-profile--email-label">
            Email
          </div>
          <div class="my-profile--email-value">
            {{eou.us.email}}
          </div>
        </div>

        <div class="my-profile--mobile my-profile--card-item">
          <div class="my-profile--mobile-label">
            Mobile
            <span *ngIf="eou.ou.mobile && !eou.ou.mobile_verified && !isMobileChanged">(unverified)</span>
            <span *ngIf="isMobileCountryCodeNotPresent">with country code</span>
          </div>
          <div class="my-profile--mobile-value">
            <input class="my-profile--mobile-value-input" [(ngModel)]="mobileNumber" type="tel" matInput
              placeholder="e.g +91 91XX XX XXX" (ngModelChange)="onMobileNumberChanged(eou)">
          </div>
        </div>

        <div *ngIf="eou.ou.employee_id" class="my-profile--mobile my-profile--card-item">
          <div class="my-profile--mobile-label">
            ID
          </div>
          <div class="my-profile--mobile-value">
            {{eou.ou.employee_id | ellipsis: 15}}
          </div>
        </div>
      </div>

      <ion-button *ngIf="eou.ou.mobile && !eou.ou.mobile_verified && !isMobileChanged" class="my-profile--primary-cta"
        fill="solid" color="fyle-primary" (click)="openOtpPopover()">
        VERIFY MOBILE
      </ion-button>
      <ion-button *ngIf="isMobileChanged" class="my-profile--primary-cta" fill="solid" color="fyle-primary"
        (click)="saveUserProfile(eou)">
        SAVE
      </ion-button>
    </div>
  </div>



  <div class="my-profile--blocks">
    <span class="my-profile--blocks-header">Notifications</span>
    <div class="my-profile--card my-profile--card-item my-profile--manage-notif"
      [routerLink]="[ '/', 'enterprise', 'notifications' ]" matRipple>
      <div class="my-profile--card-title">
        Manage Notifications
      </div>
      <div class="my-profile--notifications-arrow">
        <mat-icon>keyboard_arrow_right</mat-icon>
      </div>
    </div>
  </div>

  <ng-container *ngIf="myETxnc$|async as myETxnc">
    <div class="my-profile--blocks">
      <span class="my-profile--blocks-header">Usage</span>
      <div class="my-profile--card">
        <ng-container *ngIf="eou$|async as eou">
          <div class="my-profile--card-title">
            Using Fyle Since {{eou.ou.created_at | date: 'dd MMM, yyyy'}}
          </div>
        </ng-container>
        <div>
          <div class="my-profile--cards-content" *ngIf="toggleUsageDetailsTab">
            <div class="my-profile--stat">
              <img class="my-profile--stat-img" src="../../../assets/images/profile/gmail.svg" alt="Gmail">
              <span class="my-profile--stat-text">
                {{myETxnc.extension || 0}} expenses tracked using email extension.
              </span>
            </div>
            <div class="my-profile--stat">
              <img class="my-profile--stat-img" src="../../../assets/images/profile/outlook.svg" alt="Outlook">
              <span class="my-profile--stat-text">
                {{myETxnc.outlook || 0}} expenses tracked using outlook extension.
              </span>
            </div>

            <div class="my-profile--stat">
              <img class="my-profile--stat-img" src="../../../assets/images/profile/smartphone.svg" alt="Mobile">
              <span class="my-profile--stat-text">
                {{myETxnc.mobile || 0}} expenses tracked using mobile app.
              </span>
            </div>

            <div class="my-profile--stat">
              <img class="my-profile--stat-img" src="../../../assets/images/profile/web.svg" alt="Web">
              <span class="my-profile--stat-text">
                {{myETxnc.web || 0}} expenses tracked using web app.
              </span>
            </div>
          </div>

          <a (click)="toggleUsageDetails()">
            <span *ngIf="!toggleUsageDetailsTab">See More</span>
            <span *ngIf="toggleUsageDetailsTab">Hide</span>
          </a>
        </div>
      </div>
    </div>
  </ng-container>

  <div class="my-profile--blocks">
    <span class="my-profile--blocks-header">Preferences</span>
    <!-- Instafyle card start -->
    <div class="my-profile--card" *ngIf="orgUserSettings?.insta_fyle_settings?.allowed">
      <div class="my-profile--card-title">
        Instafyle
      </div>

      <div class="my-profile--cards-content my-profile--toggle-container">
        <div class="my-profile--toggle-label"> Scan paper receipts to automatically create expenses. </div>
        <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
          [(ngModel)]="orgUserSettings.insta_fyle_settings.enabled" (ionChange)="toggleAutoExtraction()"></ion-toggle>
      </div>
    </div>

    <!-- BulkFyle card start -->
    <div class="my-profile--cards" *ngIf="orgUserSettings?.bulk_fyle_settings?.allowed">
      <div class="my-profile--card">
        <div class="my-profile--card-title">Bulkfyle</div>
        <div class="my-profile--card-content my-profile--toggle-container">
          <span class="my-profile--toggle-label"> Submit multiple paper receipts in one go. </span>
          <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
            [(ngModel)]="orgUserSettings.bulk_fyle_settings.enabled" (ionChange)="toggleBulkMode()"></ion-toggle>
        </div>
      </div>
    </div>

    <ng-container *ngIf="eou$|async as eou">
      <div class="my-profile--card" *ngIf="eou.ou.is_primary && orgUserSettings?.one_click_action_settings?.allowed">
        <div class="my-profile--card-title">One Click Action</div>
        <div class="my-profile--card-content my-profile--toggle-container">
          <span class="my-profile--toggle-label"> Create expense from camera in one go. </span>
          <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
            [(ngModel)]="orgUserSettings.one_click_action_settings.enabled" (ionChange)="toggleOneClickActionMode()">
          </ion-toggle>
        </div>
        <div>
          <ion-label></ion-label>
          <app-fy-select [label]="'Module'" [(ngModel)]="oneClickActionSelectedModuleId"
            [options]="oneClickActionOptions" (ngModelChange)="oneClickActionModuleChanged()"></app-fy-select>
        </div>
      </div>
    </ng-container>


    <!-- Whatsapp card start -->
    <div class="my-profile--card" *ngIf="orgUserSettings?.whatsapp_fyle_settings?.allowed">
      <div class="my-profile--card-title">WhatsApp</div>
      <div class="my-profile--card-content my-profile--toggle-container">
        <div class="my-profile--toggle-label">
          Use the daily messaging app to track your expenses on the go.
        </div>
        <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
          [(ngModel)]="orgUserSettings.whatsapp_fyle_settings.enabled" (ionChange)="toggleWhatsappSettings()">
        </ion-toggle>
      </div>
      <div>
        Read More
      </div>
    </div>
  </div>

  <!-- Currency preference card start -->
  <div class="my-profile--card" *ngIf="orgSettings?.org_currency_settings?.enabled">
    <div class="my-profile--card-title">Currency Preference</div>
    <div class="my-profile--card-content my-profile--toggle-container">
      <div class="my-profile--toggle-label"> Currency Info </div>
      <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
        [(ngModel)]="orgUserSettings.currency_settings.enabled" (ionChange)="toggleCurrencySettings()"></ion-toggle>
    </div>
    <div>
      Select Currency
      <div (click)="openCurrenySelectionModal()">
        <div *ngIf="preferredCurrency$|async as preferredCurrency">
          {{preferredCurrency.id}} - {{preferredCurrency.value}}
        </div>
      </div>
    </div>
  </div>

  <div class="my-profile--card" *ngIf="orgUserSettings?.sms_fyle_settings?.allowed">
    <div class="my-profile--cards-header">
      SMS
    </div>

    <div class="my-profile--cards-content">
      <span class="my-profile--toggle-label">One SMS to track and turn receipts into expenses</span>
      <ion-toggle mode="ios" class="my-profile--toggle-value" color="success"
        [(ngModel)]="orgUserSettings.sms_fyle_settings.enabled" (ionChange)="toggleSmsSettings()"></ion-toggle>
    </div>
  </div>

  <ng-container *ngIf="eou$|async as eou">
    <ng-container *ngIf="org$|async as org">
      <div class="my-profile--card" *ngIf="!org.lite && eou.ou.roles.indexOf('ADMIN') > -1">
        <div class="my-profile--cards-header">
          Mileage Logs
        </div>
        <div class="my-profile--cards-content">
          Please login to the web application at <a (click)="openWebAppLink('app')">https://in1.fylehq.com</a> to
          change mileage settings.
        </div>
      </div>
    </ng-container>
  </ng-container>


  <div class="my-profile--card my-profile--card-item" (click)="logOut()" matRipple>
    <mat-icon svgIcon="ionic-log-out-outline"></mat-icon>
    <div>Logout</div>
  </div>
</ion-content>