<div class="add-corporate-card">
  <ion-header mode="md">
    <ion-toolbar mode="md" class="fy-modal-toolbar add-corporate-card__toolbar">
      <ion-title class="text-center add-corporate-card__toolbar-title">Add Corporate Card</ion-title>
      <ion-buttons slot="start">
        <ion-button class="add-corporate-card__toolbar-close-btn" (click)="closePopover()">
          <mat-icon class="fy-icon-close" svgIcon="fy-close"></mat-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <div class="add-corporate-card__content">
    <div class="add-corporate-card__input-container">
      <div class="add-corporate-card__input-container__label">
        <span>Enter Card Number</span>
        <span class="add-corporate-card__input-container__mandatory"> * </span>
      </div>

      <div
        class="add-corporate-card__input-container__input-wrapper"
        [ngClass]="{
          'add-corporate-card__input-container__input-wrapper--error': cardForm.touched && cardForm.invalid
        }"
      >
        <input
          class="smartlook-show add-corporate-card__input-container__input pl-0"
          inputmode="numeric"
          [formControl]="cardForm"
          mask="9999 9999 9999 9999"
          (keydown.enter)="enrollCard()"
          autocomplete="cc-number"
          required
        />

        <ng-container *ngIf="cardForm.untouched || cardForm.valid">
          <ion-icon
            *ngIf="!cardType || cardType === rtfCardTypes.OTHERS"
            src="../../../../assets/svg/card.svg"
            class="add-corporate-card__input-container__input-default-icon"
          ></ion-icon>

          <ion-icon
            *ngIf="cardType === rtfCardTypes.VISA"
            src="../../../../assets/svg/visa-logo.svg"
            class="add-corporate-card__input-container__input-issuer-icon"
          ></ion-icon>

          <ion-icon
            *ngIf="cardType === rtfCardTypes.MASTERCARD"
            src="../../../../assets/svg/mastercard-logo.svg"
            class="add-corporate-card__input-container__input-issuer-icon"
          ></ion-icon>
        </ng-container>
      </div>

      <div class="add-corporate-card__input-container__error-space"></div>

      <div *ngIf="cardForm.touched && cardForm.invalid" class="add-corporate-card__input-container__input-error">
        <ng-container *ngIf="cardForm.errors.invalidCardNumber">Please enter a valid card number.</ng-container>

        <ng-container *ngIf="cardForm.errors.invalidCardIssuer">
          <ng-container *ngIf="isVisaRTFEnabled && isMastercardRTFEnabled; else visaOnlyOrg"
            >Enter a valid Visa or Mastercard number. If you have other cards, please contact your admin.</ng-container
          >

          <ng-template #visaOnlyOrg>
            <!-- Check if only visa is enabled -->
            <ng-container *ngIf="cardForm.errors.invalidCardIssuer && isVisaRTFEnabled; else mastercardOnlyOrg"
              >Enter a valid Visa number. If you have other cards, please contact your admin.</ng-container
            >
          </ng-template>

          <ng-template #mastercardOnlyOrg>
            <!-- Check if only mastercard is enabled -->
            <ng-container *ngIf="cardForm.errors.invalidCardIssuer && isMastercardRTFEnabled"
              >Enter a valid Mastercard number. If you have other cards, please contact your admin.</ng-container
            >
          </ng-template>
        </ng-container>

        <ng-container *ngIf="cardForm.errors.enrollmentError">
          {{ enrollmentFailureMessage }}
        </ng-container>
      </div>
    </div>

    <div
      [hidden]="cardType === rtfCardTypes.OTHERS && cardForm.valid && isYodleeEnabled"
      class="add-corporate-card__tnc-container"
    >
      <ion-accordion-group>
        <ion-accordion>
          <div class="add-corporate-card__view-tnc-btn" slot="header">
            <span>View Terms and Conditions</span>
            <ion-icon
              src="../../../../assets/svg/arrow-down-primary.svg"
              class="add-corporate-card__view-tnc-btn-icon ion-accordion-toggle-icon"
            ></ion-icon>
          </div>
          <div slot="content" class="add-corporate-card__tnc">
            <div class="add-corporate-card__tnc-heading">
              By enrolling your card and clicking on "Add", you hereby agree to:
            </div>
            <ul class="add-corporate-card__tnc-list">
              <li>
                Allow your employer, card network (Visa and Others) and Fyle Inc to access details of all transactions
                made using the enrolled card. This includes the transaction amount, the name of the merchant, the date
                and time of the transaction, and any other relevant information deemed necessary to provide services.
              </li>
              <li>
                Allow Fyle to use the above details to create expenses on your behalf and enable program notifications.
              </li>
              <li>
                Agree to our
                <a
                  href="https://www.fylehq.com/privacy/terms-and-conditions"
                  target="_blank"
                  class="add-corporate-card__tnc-link"
                >
                  Terms and Conditions
                  <ion-icon
                    src="../../../../assets/svg/open-in-new-tab.svg"
                    class="add-corporate-card__tnc-link__icon"
                  ></ion-icon>
                </a>
                and
                <a
                  href="https://www.fylehq.com/privacy/privacy-policy"
                  target="_blank"
                  class="add-corporate-card__tnc-link"
                >
                  Privacy Policy
                  <ion-icon
                    src="../../../../assets/svg/open-in-new-tab.svg"
                    class="add-corporate-card__tnc-link__icon"
                  ></ion-icon>
                </a>
              </li>
            </ul>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </div>

    <ng-container *ngIf="cardType === rtfCardTypes.OTHERS && cardForm.valid && isYodleeEnabled">
      <app-fy-alert-info
        type="information"
        message="Enter a valid Visa or Mastercard number. If you have other cards, please add them on Fyle Web or contact your admin."
      ></app-fy-alert-info>
    </ng-container>
  </div>

  <div class="add-corporate-card__footer">
    <ion-button
      (click)="enrollCard()"
      [disabled]="cardType === rtfCardTypes.OTHERS && cardForm.valid && isYodleeEnabled"
      class="fy-footer-cta fy-footer-cta--primary"
      >Add</ion-button
    >
  </div>
</div>
