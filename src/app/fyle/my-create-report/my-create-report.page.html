<ion-header class="ion-no-border">
  <div class="my-create-report--header">
    <ion-toolbar class="ion-no-border my-create-report--header-toolbar">
      <ion-buttons mode="md" slot="start">
        <ion-button class="my-create-report--header-closebutton" (click)="cancel()">
          <mat-icon svgIcon="cross" class="fy-icon-close"></mat-icon>
        </ion-button>
      </ion-buttons>
      <div class="my-create-report--title-container text-center">
        <div class="my-create-report--title">Create new report</div>
        <div class="my-create-report--sub-title">
          {{ selectedElements?.length }} {{ selectedElements?.length > 1 ? 'Expenses' : 'Expense' }}
          <span class="my-create-report--amount">
            ({{ { value: selectedTotalAmount || 0, currencyCode: homeCurrency } | exactCurrency }})
          </span>
        </div>
      </div>
    </ion-toolbar>
  </div>
</ion-header>

<ion-content class="no-keyboard-adjust">
  <!-- Skeleton Loading State -->
  <div class="my-create-report--container full-height" *ngIf="isLoading">
    <!-- Report Card Skeleton -->
    <div class="my-create-report--report-card">
      <ion-skeleton-text animated class="my-create-report--skeleton-title"></ion-skeleton-text>
      <ion-skeleton-text animated class="my-create-report--skeleton-input"></ion-skeleton-text>
    </div>

    <!-- Expenses Section Skeleton -->
    <ion-skeleton-text animated class="my-create-report--skeleton-heading"></ion-skeleton-text>
    <ion-skeleton-text animated class="my-create-report--skeleton-select-all"></ion-skeleton-text>

    <!-- Expenses List Skeleton -->
    <div class="my-create-report--skeleton-expenses">
      <div class="my-create-report--skeleton-expense-item" *ngFor="let item of [1, 2, 3, 4, 5]">
        <ion-grid>
          <ion-row>
            <ion-col size="1">
              <ion-skeleton-text animated class="my-create-report--skeleton-checkbox"></ion-skeleton-text>
            </ion-col>
            <ion-col size="2">
              <ion-skeleton-text animated class="my-create-report--skeleton-expense-icon"></ion-skeleton-text>
            </ion-col>
            <ion-col size="6">
              <ion-skeleton-text animated class="my-create-report--skeleton-expense-title"></ion-skeleton-text>
              <ion-skeleton-text animated class="my-create-report--skeleton-expense-subtitle"></ion-skeleton-text>
            </ion-col>
            <ion-col size="3">
              <ion-skeleton-text animated class="my-create-report--skeleton-expense-amount"></ion-skeleton-text>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </div>
  </div>

  <!-- Actual Content -->
  <div class="my-create-report--container full-height" *ngIf="!isLoading">
    <div class="my-create-report--report-card">
      <div class="my-create-report--report-title">Expense report name</div>
      <span class="my-create-report--mandatory"> * </span>
      <input
        data-testid="report-name"
        class="my-create-report--report-name smartlook-show"
        name="reportName"
        type="text"
        placeholder="Enter report name"
        [(ngModel)]="reportTitle"
        required
        (ngModelChange)="detectTitleChange()"
        #reportTitleInput="ngModel"
      />
    </div>
    @if (showReportNameError) {
      <div class="my-create-report--error-message">Please enter expense report name.</div>
    }
    @if (readyToReportExpenses?.length === 0) {
      <div class="my-create-report--zero-state">
        <div>
          <img
            alt="Create First Expenses"
            class="my-create-report--zero-state-img"
            src="../../../assets/svg/zero-states/expenses.svg"
          />
          <div class="my-create-report--zero-state-text">You have no reportable</div>
          <div class="my-create-report--zero-state-text">expenses right now</div>
        </div>
      </div>
    }
    @if (readyToReportExpenses?.length > 0) {
      <div class="my-create-report--heading">Expenses</div>
    }
    @if (readyToReportExpenses?.length > 0) {
      <div class="my-create-report--select-all-checkbox">
        <mat-checkbox
          class="custom-mat-checkbox create-new-report--checkbox"
          [(ngModel)]="isSelectedAll"
          (ngModelChange)="toggleSelectAll($event)"
        >
          Select all</mat-checkbox
        >
      </div>
    }
    @if (readyToReportExpenses) {
      <div>
        @for (etxn of readyToReportExpenses; track etxn.id; let i = $index) {
          <div>
            <app-expense-card-v2
              [expense]="etxn"
              [previousExpenseTxnDate]="readyToReportExpenses[i - 1]?.spent_at"
              [previousExpenseCreatedAt]="readyToReportExpenses[i - 1]?.created_at"
              [showDt]="checkShowDt(etxn, i)"
              [isSelectionModeEnabled]="true"
              [selectedElements]="selectedElements"
              (cardClickedForSelection)="selectExpense($event)"
              [isFromReports]="true"
            >
            </app-expense-card-v2>
          </div>
        }
      </div>
    }
  </div>
</ion-content>

<ion-footer>
  <ion-toolbar mode="md">
    <div class="fy-footer-cta-container">
      <ion-button
        class="fy-footer-cta fy-footer-cta--tertiary-secondary"
        (click)="ctaClickedEvent('create_draft_report')"
        appFormButtonValidation
        [loading]="saveDraftReportLoading"
        [loadingText]="'Saving Report'"
        [disabled]="emptyInput"
      >
        Save as draft
      </ion-button>
      <ion-button
        class="fy-footer-cta fy-footer-cta--primary"
        (click)="ctaClickedEvent('submit_report')"
        appFormButtonValidation
        [loading]="saveReportLoading"
        [loadingText]="'Submitting Report'"
        [disabled]="selectedElements?.length === 0 || saveDraftReportLoading || saveReportLoading"
      >
        Submit report
      </ion-button>
    </div>
  </ion-toolbar>
</ion-footer>
