<div class="dashboard--background-container">
  <div class="dashboard--background"></div>
</div>

@if (currentStateIndex===1) {
<ion-header class="tasks--header" mode="md" translucent="true">
  <ion-toolbar class="dashboard--toolbar">
    <ion-buttons slot="start">
      <app-fy-menu-icon></app-fy-menu-icon>
    </ion-buttons>
    <ion-title class="dashboard--title" mode="md"> Tasks </ion-title>
    <ion-buttons slot="end">
      <ion-button>
        <ion-button class="tasks--header-btn" (click)="openFilters()">
          @if (filterPills?.length) {
          <ion-icon slot="icon-only" src="../../../assets/svg/filter-applied.svg"></ion-icon>
          } @else {
          <ion-icon slot="icon-only" src="../../../assets/svg/filter.svg"></ion-icon>
          }
        </ion-button>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
} @if (!(currentStateIndex === 1)) {
<ion-header mode="md" class="dashboard--header">
  <ion-toolbar class="stats--toolbar" [ngClass]="{'dashboard--opt-in-gradient': canShowOptInBanner$ | async}">
    <ion-buttons slot="start">
      <app-fy-menu-icon></app-fy-menu-icon>
    </ion-buttons>
    <ion-title class="stats--title" mode="md"> Home </ion-title>
    @if (isConnected$ | async) {
    <ion-buttons slot="end">
      @if ((orgSettings$ | async) && (specialCategories$ | async)) {
      <div class="stats--action-shortcut" (click)="openAddExpenseActionSheet()">
        <mat-icon svgIcon="plus-square"></mat-icon>
      </div>
      } @else {
      <div class="stats--action-shortcut--skeleton-icon">
        <ion-skeleton-text class="m-0" animated></ion-skeleton-text>
      </div>
      }
    </ion-buttons>
    }
  </ion-toolbar>
</ion-header>
}

<ion-content class="dashboard--body">
  <mat-tab-group animationDuration="0ms" class="dashboard--tabs" [selectedIndex]="currentStateIndex">
    <mat-tab label="stats">
      @if (isConnected$ | async) { @if (!(isUserFromINCluster$ | async)) { @if (eou$ | async; as eou) { @if
      (canShowOptInBanner$ | async) {
      <app-dashboard-opt-in [extendedOrgUser]="eou" (toggleOptInBanner)="toggleOptInBanner($event)">
      </app-dashboard-opt-in>
      } } } }
      <app-stats></app-stats>
      <app-card-stats (cardAdded)="onCardAdded()"></app-card-stats>
    </mat-tab>
    <mat-tab label="tasks">
      <app-tasks (optedIn)="hideOptInDashboardBanner()"></app-tasks>
    </mat-tab>
  </mat-tab-group>
</ion-content>

<ion-footer>
  <app-fy-footer
    (homeClicked)="onHomeClicked()"
    (taskClicked)="onTaskClicked()"
    (cameraClicked)="onCameraClicked()"
    [taskCount]="displayedTaskCount"
    [activeState]="currentStateIndex===0?FooterState.HOME: FooterState.TASKS"
  ></app-fy-footer>
</ion-footer>
