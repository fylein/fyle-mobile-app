<ion-content scroll-y="false" class="no-keyboard-adjust">
  <div class="new-password">
    <div>
      <ion-icon
        class="fy-icon new-password__back-icon"
        src="../../../assets/svg/arrow-tail-left.svg"
        (click)="redirectToSignIn()"
      ></ion-icon>
      <div>
        <div class="new-password__form-header">Reset password</div>
        <div>
          <form *ngIf="fg" [formGroup]="fg">
            <div class="new-password__input-container">
              <div
                class="new-password__text new-password__text-block"
                [ngClass]="{'new-password__text__invalid': fg.controls.password.touched && !fg.controls.password.valid}"
              >
                <div class="new-password__text-label">New password</div>
                <div class="new-password__password-container">
                  <input
                    placeholder="Enter password"
                    [required]="true"
                    [type]="hide ? 'password': 'text'"
                    class="new-password__text-input smartlook-show"
                    formControlName="password"
                    (focus)="setPasswordTooltip(true)"
                    (blur)="setPasswordTooltip(false)"
                  />
                  <div class="new-password__password-icon-container" matSuffix (click)="hide = !hide">
                    <ion-icon
                      class="fy-icon new-password__password-icon"
                      src="{{hide ? '/assets/svg/eye-slash.svg' : '/assets/svg/eye.svg'}}"
                    ></ion-icon>
                  </div>
                </div>
                <app-password-check-tooltip
                  *ngIf="showPasswordTooltip"
                  [password]="fg.controls.password.value"
                  (isPasswordValid)="onPasswordValid($event)"
                ></app-password-check-tooltip>
              </div>
              <div
                *ngIf="fg.controls.password.touched && fg.controls.password.invalid && fg.controls.password.errors.required"
                class="new-password__error"
              >
                <mat-icon class="new-password__error-message-icon" svgIcon="danger-fill"></mat-icon>
                Password cannot be empty
              </div>
              <div
                *ngIf="fg.controls.password.touched && fg.controls.password.invalid && fg.controls.password.errors.invalidPassword && !fg.controls.password.errors.required"
                class="new-password__error"
              >
                <mat-icon class="new-password__error-message-icon" svgIcon="danger-fill"></mat-icon>
                Please enter a valid password.
              </div>
            </div>
            <div class="new-password__input-container">
              <div
                class="new-password__text new-password__text-block"
                [ngClass]="{'new-password__text__invalid': fg.controls.confirmPassword.touched && !fg.controls.confirmPassword.valid}"
              >
                <div class="new-password__text-label">Confirm new password</div>
                <div class="new-password__password-container">
                  <input
                    placeholder="Re-enter password"
                    [required]="true"
                    [type]="hideConfirmPassword ? 'text': 'password'"
                    class="new-password__text-input smartlook-show"
                    formControlName="confirmPassword"
                  />
                  <div
                    class="new-password__password-icon-container"
                    matSuffix
                    (click)="hideConfirmPassword = !hideConfirmPassword"
                  >
                    <ion-icon
                      class="fy-icon new-password__password-icon"
                      src="{{hideConfirmPassword ? '/assets/svg/eye-slash.svg' : '/assets/svg/eye.svg' }}"
                    ></ion-icon>
                  </div>
                </div>
              </div>
              <div
                *ngIf="fg.controls.confirmPassword.touched && fg.controls.confirmPassword.invalid && fg.controls.confirmPassword.errors.required"
                class="new-password__error"
              >
                <mat-icon class="new-password__error-message-icon" svgIcon="danger-fill"></mat-icon>
                Password cannot be empty
              </div>
              <div
                *ngIf="fg.controls.confirmPassword.touched && fg.controls.confirmPassword.invalid && fg.controls.confirmPassword.errors.passwordMismatch"
                class="new-password__error"
              >
                <mat-icon class="new-password__error-message-icon" svgIcon="danger-fill"></mat-icon>
                Passwords do not match
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div *ngIf="fg">
      <ion-button (click)="changePassword()" class="btn-primary" fill="clear" [disabled]="!fg.valid">
        Reset password
      </ion-button>
      <div class="new-password__cta-secondary" (click)="redirectToSignIn()">
        <ion-icon class="new-password__arrow-icon" [src]="'/assets/svg/arrow-left.svg'" slot="icon-only"></ion-icon>
        <span class="new-password__cta-text">Back to sign in</span>
      </div>
    </div>
  </div>
</ion-content>
